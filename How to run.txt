1: Go to your working folder

cd /mnt/e/pahg_bigsearch
-------

2: Paste a new family (manual, safe pattern)

Open the file:

nano catalog.json

Find the "families": [ line. Insert a comma after the last family block, then paste a new family block before the closing ] of "families".

Use this mini-template and just replace the ALL-CAPS tokens:

{
  "familyId": "REPLACE_NUMERIC_ID",
  "familySymbol": "REPLACE_SYMBOL",
  "familyTitle": "REPLACE TITLE (SHORT, CLEAR)",
  "familyUrl": "https://www.pahgncb.com/genomedb/public/searchfamily?fid=REPLACE_FID_OR_USE_HOMEPAGE",
  "familyDescription": "Short sentence describing the family.",
  "members": [
    { "memberId": "MID_1", "geneSymbol": "GENE1", "url": "https://www.pahgncb.com/genomedb/public/searchmember?mid=###" },
    { "memberId": "MID_2", "geneSymbol": "GENE2", "url": "https://www.pahgncb.com/genomedb/public/searchmember?mid=###" }
    // add more member rows as needed (no trailing comma on the last one)
  ]
}


Save and exit nano:

Ctrl+O → Enter

Ctrl+X

Tip: If you don’t know a fid yet, temporarily use the PAHG homepage
"familyUrl": "https://www.pahgncb.com/" (you can refine later).

----------------

Quick JSON validity check (catches missing commas/brackets)



python3 - <<'PY'
import json; json.load(open("catalog.json","r",encoding="utf-8"))
print("catalog.json: JSON OK")
PY


If you see an error, note the line/column, reopen with nano catalog.json, fix, and re-run.

--------------------

Rebuild index.bs
python3 make_index_bs.py


Expected output (numbers will grow over time):
OK: wrote index.bs (… lines)

---------------------

5) Validate the generated index.bs (two checks)

A. Every line has exactly 2 tab-separated fields

awk -F '\t' 'NF!=2{print "Bad line #", NR}' index.bs || echo "All lines have 2 fields"


B. Each JSON blob is valid

python3 - <<'PY'
import json
for i,l in enumerate(open("index.bs","r",encoding="utf-8"),1):
    tag, js = l.rstrip("\n").split("\t",1)
    assert tag in ("DB","ENTRY")
    json.loads(js)
print("index.bs: JSON OK")
PY


6) Quick counts (sanity check growth)
echo "Total lines : $(wc -l < index.bs)"
echo "ENTRY lines : $(grep -c '^ENTRY' index.bs)"
echo "Families    : $(grep -c '\"type\":\"family\"' index.bs)"
echo "Genes       : $(grep -c '\"type\":\"gene\"' index.bs)"


7) Update the date (when you want to bump the timestamp)

This keeps the DB header and all ENTRY timestamps aligned.

python3 - <<'PY'
import json, pathlib
p = pathlib.Path("catalog.json")
data = json.loads(p.read_text(encoding="utf-8"))

# single source of truth for the date
data["db"]["updatedAt"] = "2025-11-03 00:00:00"

p.write_text(json.dumps(data, ensure_ascii=False, indent=2), encoding="utf-8")
print("catalog.json: updatedAt set to", data["db"]["updatedAt"])
PY

# rebuild so index.bs picks up the new date
python3 make_index_bs.py


On future days, just change the date string to that day’s date/time.
